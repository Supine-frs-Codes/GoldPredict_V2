<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥‡ é»„é‡‘ä»·æ ¼é¢„æµ‹ç³»ç»Ÿ - æ“ä½œç•Œé¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .action-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary { background: linear-gradient(45deg, #007bff, #0056b3); color: white; }
        .btn-success { background: linear-gradient(45deg, #28a745, #1e7e34); color: white; }
        .btn-warning { background: linear-gradient(45deg, #ffc107, #e0a800); color: #333; }
        .btn-danger { background: linear-gradient(45deg, #dc3545, #c82333); color: white; }
        .btn-info { background: linear-gradient(45deg, #17a2b8, #138496); color: white; }
        
        .output-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .output-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            border: 2px solid #333;
        }
        
        .output-line {
            margin-bottom: 5px;
            word-wrap: break-word;
        }
        
        .timestamp {
            color: #888;
            font-size: 12px;
        }
        
        .task-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-running { background: #ffc107; color: #333; }
        .status-completed { background: #28a745; color: white; }
        .status-failed { background: #dc3545; color: white; }
        
        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .file-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: #28a745; }
        .notification.error { background: #dc3545; }
        .notification.info { background: #17a2b8; }

        /* é…ç½®é¢æ¿æ ·å¼ */
        .config-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: white;
        }

        .config-panel h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .config-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .config-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 8px;
        }

        .config-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .config-option {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .config-option:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .config-option input[type="radio"] {
            margin-right: 12px;
            margin-top: 2px;
            transform: scale(1.2);
        }

        .config-option input[type="radio"]:checked + .option-label {
            font-weight: bold;
            color: #ffd700;
        }

        .config-option input[type="radio"]:checked {
            accent-color: #ffd700;
        }

        .config-option.selected {
            border-color: #ffd700;
            background: rgba(255,215,0,0.2);
        }

        .option-content {
            flex: 1;
        }

        .option-label {
            display: block;
            font-weight: 500;
            margin-bottom: 4px;
            font-size: 1.1em;
        }

        .option-desc {
            display: block;
            font-size: 0.9em;
            opacity: 0.8;
            line-height: 1.3;
        }

        .config-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .config-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 150px;
        }

        .config-btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,107,0.4);
        }

        .config-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255,107,107,0.6);
        }

        .config-btn.secondary {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
            box-shadow: 0 4px 15px rgba(116,185,255,0.4);
        }

        .config-btn.secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(116,185,255,0.6);
        }

        .config-btn.info {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            color: white;
            box-shadow: 0 4px 15px rgba(162,155,254,0.4);
        }

        .config-btn.info:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(162,155,254,0.6);
        }

        .config-btn.success {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
            box-shadow: 0 4px 15px rgba(0,184,148,0.4);
        }

        .config-btn.success:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,184,148,0.6);
        }

        .config-btn.warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            color: white;
            box-shadow: 0 4px 15px rgba(253,203,110,0.4);
        }

        .config-btn.warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(253,203,110,0.6);
        }
        
        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥‡ é»„é‡‘ä»·æ ¼é¢„æµ‹ç³»ç»Ÿ</h1>
            <p>å®æ—¶æ“ä½œç•Œé¢ - ä¸€é”®æ‰§è¡Œå„ç§åŠŸèƒ½æ¨¡å—</p>
        </div>

        <!-- é…ç½®é¢æ¿ -->
        <div class="config-panel">
            <h2>âš™ï¸ é¢„æµ‹é…ç½®</h2>
            <div class="config-grid">
                <div class="config-section">
                    <h3>ğŸ“Š æ•°æ®æºé€‰æ‹©</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="data_source" value="mt5" checked>
                            <span class="option-label">ğŸ”— MetaTrader 5 (å®æ—¶)</span>
                            <span class="option-desc">æœ€æ–°å®æ—¶æ•°æ®ï¼Œæ— APIé™åˆ¶</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="data_source" value="multi_source">
                            <span class="option-label">ğŸŒ å¤šæ•°æ®æº (æ™ºèƒ½)</span>
                            <span class="option-desc">MT5 + APIæ™ºèƒ½åˆ‡æ¢</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="data_source" value="yahoo">
                            <span class="option-label">ğŸ“ˆ Yahoo Finance</span>
                            <span class="option-desc">ä¼ ç»Ÿæ•°æ®æº</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="data_source" value="alpha_vantage">
                            <span class="option-label">ğŸ”‘ Alpha Vantage</span>
                            <span class="option-desc">éœ€è¦APIå¯†é’¥</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>ğŸ“… æ—¶é—´è·¨åº¦</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1d">
                            <span class="option-label">âš¡ 1å¤© (å®æ—¶)</span>
                            <span class="option-desc">æœ€æ–°ä»·æ ¼ï¼Œå®æ—¶æ›´æ–°</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1w">
                            <span class="option-label">ğŸ“Š 1å‘¨</span>
                            <span class="option-desc">çŸ­æœŸè¶‹åŠ¿åˆ†æ</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1mo">
                            <span class="option-label">ğŸ“ˆ 1ä¸ªæœˆ</span>
                            <span class="option-desc">ä¸­æœŸè¶‹åŠ¿åˆ†æ</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="3mo" checked>
                            <span class="option-label">ğŸ“Š 3ä¸ªæœˆ</span>
                            <span class="option-desc">æ ‡å‡†åˆ†æå‘¨æœŸ</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="6mo">
                            <span class="option-label">ğŸ“ˆ 6ä¸ªæœˆ</span>
                            <span class="option-desc">é•¿æœŸè¶‹åŠ¿åˆ†æ</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1y">
                            <span class="option-label">ğŸ“Š 1å¹´</span>
                            <span class="option-desc">å¹´åº¦è¶‹åŠ¿åˆ†æ</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>ğŸ–¥ï¸ å¤„ç†å™¨é…ç½®</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="auto" checked>
                            <span class="option-label">ğŸš€ è‡ªåŠ¨ (æ¨è)</span>
                            <span class="option-desc">ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ ¸å¿ƒæ•°</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="single">
                            <span class="option-label">ğŸ”„ å•æ ¸</span>
                            <span class="option-desc">å•çº¿ç¨‹å¤„ç†</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="half">
                            <span class="option-label">âš¡ åŠæ•°æ ¸å¿ƒ</span>
                            <span class="option-desc">å¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="max">
                            <span class="option-label">ğŸ”¥ å…¨éƒ¨æ ¸å¿ƒ</span>
                            <span class="option-desc">æœ€å¤§æ€§èƒ½æ¨¡å¼</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>ğŸ¯ é¢„æµ‹æ¨¡å¼</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="prediction_mode" value="simple" checked>
                            <span class="option-label">ğŸ”® ç®€å•é¢„æµ‹</span>
                            <span class="option-desc">åŸºç¡€æŠ€æœ¯åˆ†æï¼Œå¿«é€Ÿæ‰§è¡Œ</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="prediction_mode" value="advanced">
                            <span class="option-label">ğŸ§  å¤æ‚é¢„æµ‹</span>
                            <span class="option-desc">å¤šæŒ‡æ ‡é›†æˆï¼Œç²¾ç¡®åˆ†æ</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="prediction_mode" value="ultimate">
                            <span class="option-label">ğŸš€ ç»ˆæé¢„æµ‹</span>
                            <span class="option-desc">AIå¢å¼ºï¼Œæœ€é«˜ç²¾åº¦</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="config-actions">
                <button class="config-btn primary" onclick="runConfiguredPrediction()">
                    ğŸ¯ æ‰§è¡Œé…ç½®é¢„æµ‹
                </button>
                <button class="config-btn secondary" onclick="resetConfig()">
                    ğŸ”„ é‡ç½®é…ç½®
                </button>
                <button class="config-btn info" onclick="testDataSource()">
                    ğŸ§ª æµ‹è¯•æ•°æ®æº
                </button>
                <button class="config-btn success" onclick="getRealTimeData()">
                    ğŸ“¡ å®æ—¶æ•°æ®æµ
                </button>
                <button class="config-btn warning" onclick="openRealTimePrediction()">
                    ğŸ¤– å®æ—¶é¢„æµ‹ç³»ç»Ÿ
                </button>
            </div>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€é¢æ¿ -->
        <div class="status-panel">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div class="status-grid" id="systemStatus">
                <div class="status-item">
                    <h3>ğŸ”„ æœåŠ¡å™¨çŠ¶æ€</h3>
                    <p id="server-status">è¿è¡Œä¸­</p>
                </div>
                <div class="status-item">
                    <h3>ğŸ“Š å½“å‰æ•°æ®æº</h3>
                    <p id="current-data-source">MetaTrader 5</p>
                </div>
                <div class="status-item">
                    <h3>ğŸ–¥ï¸ CPUæ ¸å¿ƒ</h3>
                    <p id="cpu-cores">è‡ªåŠ¨</p>
                </div>
                <div class="status-item">
                    <h3>â° æœ€åæ›´æ–°</h3>
                    <p id="last-update">--</p>
                </div>
                <div class="status-item">
                    <h3>ğŸ“¡ MT5è¿æ¥</h3>
                    <p id="mt5-status">æ£€æµ‹ä¸­...</p>
                </div>
                <div class="status-item">
                    <h3>ğŸ’¾ æ•°æ®è®°å½•</h3>
                    <p id="data-records">--</p>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <!-- åŸºç¡€åŠŸèƒ½ -->
            <div class="panel">
                <h2>ğŸ”§ åŸºç¡€åŠŸèƒ½</h2>
                <div class="button-grid">
                    <button class="action-btn btn-info" onclick="runTask('gpu_test')">
                        ğŸ–¥ï¸ GPUæµ‹è¯•
                    </button>
                    <button class="action-btn btn-info" onclick="runTask('gpu_setup')">
                        âš™ï¸ GPUç¯å¢ƒæ£€æµ‹
                    </button>
                    <button class="action-btn btn-primary" onclick="runTask('data_collection')">
                        ğŸ“Š æ•°æ®æ”¶é›†
                    </button>
                    <button class="action-btn btn-success" onclick="runTask('quick_demo')">
                        âš¡ å¿«é€Ÿæ¼”ç¤º
                    </button>
                    <button class="action-btn btn-warning" onclick="runTask('organize_files')">
                        ğŸ—‚ï¸ æ•´ç†æ–‡ä»¶
                    </button>
                </div>
            </div>
            
            <!-- é«˜çº§åŠŸèƒ½ -->
            <div class="panel">
                <h2>ğŸš€ é«˜çº§åŠŸèƒ½</h2>
                <div class="button-grid">
                    <button class="action-btn btn-primary" onclick="runTask('train_basic')">
                        ğŸ¤– åŸºç¡€è®­ç»ƒ
                    </button>
                    <button class="action-btn btn-success" onclick="runTask('train_optimized')">
                        âš¡ ä¼˜åŒ–è®­ç»ƒ
                    </button>
                    <button class="action-btn btn-success" onclick="runTask('predict_simple')">
                        ğŸ”® ç®€å•é¢„æµ‹
                    </button>
                    <button class="action-btn btn-info" onclick="runTask('predict_multiple')">
                        ğŸ“Š å¤šæ—¶é—´é¢„æµ‹
                    </button>
                    <button class="action-btn btn-warning" onclick="runTask('predict_uncertainty')">
                        ğŸ“ˆ ä¸ç¡®å®šæ€§é¢„æµ‹
                    </button>
                </div>

                <div class="section">
                    <h3>[ç»ˆæ] ä¸€é”®é¢„æµ‹ç³»ç»Ÿ</h3>
                    <button class="action-btn btn-danger" onclick="runTask('ultimate_prediction')"
                            style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); font-size: 16px; font-weight: bold;">
                        ğŸš€ ä¸€é”®ç»ˆæé¢„æµ‹
                    </button>
                    <button class="action-btn btn-dark" onclick="runTask('advanced_training')"
                            style="background: linear-gradient(45deg, #2c2c54, #40407a); font-size: 16px; font-weight: bold;">
                        ğŸ§  é«˜çº§æ·±åº¦è®­ç»ƒ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- è¾“å‡ºé¢æ¿ -->
        <div class="output-panel">
            <h2>ğŸ“ å®æ—¶è¾“å‡º</h2>
            <div class="output-container" id="outputContainer">
                <div class="output-line">ğŸŒ Webç•Œé¢å·²å¯åŠ¨ï¼Œç­‰å¾…ä»»åŠ¡æ‰§è¡Œ...</div>
            </div>
        </div>
        
        <!-- ç»“æœæ–‡ä»¶é¢æ¿ -->
        <div class="results-panel">
            <h2>ğŸ“ ç»“æœæ–‡ä»¶</h2>
            <button class="action-btn btn-info" onclick="refreshResults()">ğŸ”„ åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</button>
            <div class="file-list" id="fileList">
                <div class="file-item">
                    <h4>ğŸ”„ åŠ è½½ä¸­...</h4>
                    <p>æ­£åœ¨æ‰«æç»“æœæ–‡ä»¶</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>
    
    <script>
        // Socket.IOè¿æ¥
        const socket = io();
        let currentTasks = {};
        
        // è¿æ¥äº‹ä»¶
        socket.on('connect', function() {
            console.log('å·²è¿æ¥åˆ°æœåŠ¡å™¨');
            showNotification('å·²è¿æ¥åˆ°æœåŠ¡å™¨', 'success');
            loadSystemStatus();
            refreshResults();
        });
        
        // ä»»åŠ¡å¼€å§‹
        socket.on('task_start', function(data) {
            addOutput(`ğŸš€ å¼€å§‹æ‰§è¡Œ: ${data.description}`, 'info');
            currentTasks[data.task_id] = data;
        });
        
        // ä»»åŠ¡è¾“å‡º
        socket.on('task_output', function(data) {
            addOutput(data.output, 'output');
        });
        
        // ä»»åŠ¡å®Œæˆ
        socket.on('task_complete', function(data) {
            if (data.status === 'success') {
                addOutput(`âœ… ä»»åŠ¡å®Œæˆ: ${currentTasks[data.task_id]?.description}`, 'success');
                showNotification('ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼', 'success');
                refreshResults(); // åˆ·æ–°ç»“æœæ–‡ä»¶
            } else {
                addOutput(`âŒ ä»»åŠ¡å¤±è´¥: ${currentTasks[data.task_id]?.description}`, 'error');
                showNotification('ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼', 'error');
            }
            delete currentTasks[data.task_id];
        });
        
        // ä»»åŠ¡é”™è¯¯
        socket.on('task_error', function(data) {
            addOutput(`ğŸ’¥ é”™è¯¯: ${data.error}`, 'error');
            showNotification(`æ‰§è¡Œé”™è¯¯: ${data.error}`, 'error');
            delete currentTasks[data.task_id];
        });
        
        // æ‰§è¡Œä»»åŠ¡
        function runTask(taskType) {
            const button = event.target;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> æ‰§è¡Œä¸­...';
            
            fetch('/api/run_task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({task_type: taskType})
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showNotification(`å¯åŠ¨å¤±è´¥: ${data.error}`, 'error');
                } else {
                    addOutput(`ğŸ“‹ ä»»åŠ¡å·²å¯åŠ¨: ${data.description}`, 'info');
                }
            })
            .catch(error => {
                showNotification(`è¯·æ±‚å¤±è´¥: ${error}`, 'error');
            })
            .finally(() => {
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = button.innerHTML.replace('<span class="loading"></span> æ‰§è¡Œä¸­...', button.textContent);
                }, 2000);
            });
        }
        
        // æ·»åŠ è¾“å‡º
        function addOutput(text, type = 'output') {
            const container = document.getElementById('outputContainer');
            const line = document.createElement('div');
            line.className = 'output-line';
            
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': '#00bfff',
                'success': '#00ff00', 
                'error': '#ff4444',
                'output': '#00ff00'
            };
            
            line.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span style="color: ${colors[type]}">${text}</span>`;
            container.appendChild(line);
            container.scrollTop = container.scrollHeight;
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // é…ç½®ç›¸å…³å‡½æ•°
        function getSelectedConfig() {
            const dataSource = document.querySelector('input[name="data_source"]:checked')?.value || 'mt5';
            const timePeriod = document.querySelector('input[name="time_period"]:checked')?.value || '3mo';
            const cpuCores = document.querySelector('input[name="cpu_cores"]:checked')?.value || 'auto';
            const predictionMode = document.querySelector('input[name="prediction_mode"]:checked')?.value || 'simple';

            return {
                data_source: dataSource,
                time_period: timePeriod,
                cpu_cores: cpuCores,
                prediction_mode: predictionMode
            };
        }

        function updateStatusDisplay() {
            const config = getSelectedConfig();

            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            const dataSourceNames = {
                'mt5': 'MetaTrader 5',
                'multi_source': 'å¤šæ•°æ®æº',
                'yahoo': 'Yahoo Finance',
                'alpha_vantage': 'Alpha Vantage'
            };

            const cpuCoreNames = {
                'auto': 'è‡ªåŠ¨',
                'single': 'å•æ ¸',
                'half': 'åŠæ•°æ ¸å¿ƒ',
                'max': 'å…¨éƒ¨æ ¸å¿ƒ'
            };

            document.getElementById('current-data-source').textContent = dataSourceNames[config.data_source];
            document.getElementById('cpu-cores').textContent = cpuCoreNames[config.cpu_cores];
        }

        function runConfiguredPrediction() {
            const config = getSelectedConfig();

            showNotification(`å¯åŠ¨${config.prediction_mode}é¢„æµ‹ - æ•°æ®æº: ${config.data_source}, æ—¶é—´: ${config.time_period}`, 'info');

            // æ ¹æ®é…ç½®é€‰æ‹©ç›¸åº”çš„é¢„æµ‹æ¨¡å¼
            let taskName;
            if (config.prediction_mode === 'simple') {
                taskName = 'predict_simple';
            } else if (config.prediction_mode === 'advanced') {
                taskName = 'predict_multiple';
            } else if (config.prediction_mode === 'ultimate') {
                taskName = 'ultimate_prediction';
            }

            // æ‰§è¡Œä»»åŠ¡ï¼Œä¼ é€’é…ç½®å‚æ•°
            runTaskWithConfig(taskName, config);
        }

        function runTaskWithConfig(taskName, config) {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '';
            outputDiv.style.display = 'block';

            // æ˜¾ç¤ºé…ç½®ä¿¡æ¯
            outputDiv.innerHTML += `<div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                <strong>ğŸ¯ é¢„æµ‹é…ç½®:</strong><br>
                ğŸ“Š æ•°æ®æº: ${config.data_source}<br>
                ğŸ“… æ—¶é—´è·¨åº¦: ${config.time_period}<br>
                ğŸ–¥ï¸ CPUæ ¸å¿ƒ: ${config.cpu_cores}<br>
                ğŸ¯ é¢„æµ‹æ¨¡å¼: ${config.prediction_mode}
            </div>`;

            showNotification(`ğŸš€ å¼€å§‹æ‰§è¡Œ: ${taskName}`, 'info');

            fetch('/run_task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    task: taskName,
                    config: config
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`âœ… ä»»åŠ¡å®Œæˆ: ${taskName}`, 'success');
                } else {
                    showNotification(`âŒ ä»»åŠ¡å¤±è´¥: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('âŒ ç½‘ç»œé”™è¯¯', 'error');
            });

            // å¼€å§‹è½®è¯¢è¾“å‡º
            pollOutput();
        }

        function resetConfig() {
            // é‡ç½®æ‰€æœ‰é…ç½®ä¸ºé»˜è®¤å€¼
            document.querySelector('input[name="data_source"][value="mt5"]').checked = true;
            document.querySelector('input[name="time_period"][value="3mo"]').checked = true;
            document.querySelector('input[name="cpu_cores"][value="auto"]').checked = true;
            document.querySelector('input[name="prediction_mode"][value="simple"]').checked = true;

            updateStatusDisplay();
            showNotification('ğŸ”„ é…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼', 'info');
        }

        function testDataSource() {
            const config = getSelectedConfig();
            showNotification(`ğŸ§ª æµ‹è¯•æ•°æ®æº: ${config.data_source}`, 'info');

            // æ‰§è¡Œæ•°æ®æºæµ‹è¯•
            runTaskWithConfig('test_data_source', config);
        }

        function getRealTimeData() {
            const config = getSelectedConfig();

            if (config.data_source !== 'mt5') {
                showNotification('âš ï¸ å®æ—¶æ•°æ®æµéœ€è¦MetaTrader 5æ•°æ®æº', 'error');
                return;
            }

            showNotification('ğŸ“¡ å¯åŠ¨å®æ—¶æ•°æ®æµ...', 'info');
            runTaskWithConfig('realtime_data', config);
        }

        function openRealTimePrediction() {
            // æ‰“å¼€å®æ—¶é¢„æµ‹ç³»ç»Ÿçª—å£
            const realtimeUrl = 'http://localhost:5001';
            const realtimeWindow = window.open(realtimeUrl, 'realtime_prediction', 'width=1200,height=800,scrollbars=yes,resizable=yes');

            if (realtimeWindow) {
                showNotification('ğŸ¤– å®æ—¶é¢„æµ‹ç³»ç»Ÿå·²æ‰“å¼€', 'success');
            } else {
                showNotification('âŒ æ— æ³•æ‰“å¼€å®æ—¶é¢„æµ‹ç³»ç»Ÿï¼Œè¯·æ£€æŸ¥å¼¹çª—æ‹¦æˆª', 'error');
                // å¤‡ç”¨æ–¹æ¡ˆï¼šåœ¨å½“å‰é¡µé¢æ˜¾ç¤ºé“¾æ¥
                const outputDiv = document.getElementById('output');
                outputDiv.innerHTML = `
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3>ğŸ¤– å®æ—¶é¢„æµ‹ç³»ç»Ÿ</h3>
                        <p>å¦‚æœæ–°çª—å£æ²¡æœ‰æ‰“å¼€ï¼Œè¯·ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥ï¼š</p>
                        <a href="${realtimeUrl}" target="_blank" style="color: #1976d2; font-weight: bold; font-size: 1.2em;">
                            ${realtimeUrl}
                        </a>
                        <br><br>
                        <p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
                        <ul>
                            <li>ğŸ”„ æ¯5åˆ†é’Ÿè‡ªåŠ¨é¢„æµ‹</li>
                            <li>ğŸ“Š è½»é‡çº§ + å¤æ‚ + æ·±åº¦å­¦ä¹ é¢„æµ‹</li>
                            <li>ğŸ“ˆ å®æ—¶äº¤æ˜“ä¿¡å·</li>
                            <li>âœ… å‡†ç¡®ç‡éªŒè¯</li>
                            <li>ğŸ“± å®æ—¶Webç•Œé¢</li>
                        </ul>
                    </div>
                `;
                outputDiv.style.display = 'block';
            }
        }
        
        // åŠ è½½ç³»ç»ŸçŠ¶æ€
        function loadSystemStatus() {
            fetch('/api/system_status')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('systemStatus');
                container.innerHTML = `
                    <div class="status-item">
                        <h3>ğŸ–¥ï¸ GPUçŠ¶æ€</h3>
                        <p>${data.gpu_available ? 'âœ… ' + data.gpu_info : 'âŒ æœªæ£€æµ‹åˆ°GPU'}</p>
                    </div>
                    <div class="status-item">
                        <h3>ğŸ“Š æ•°æ®æ–‡ä»¶</h3>
                        <p>${data.data_files} ä¸ªæ•°æ®æ–‡ä»¶</p>
                    </div>
                    <div class="status-item">
                        <h3>ğŸ¤– æ¨¡å‹æ–‡ä»¶</h3>
                        <p>${data.model_files} ä¸ªæ¨¡å‹æ–‡ä»¶</p>
                    </div>
                    <div class="status-item">
                        <h3>ğŸ Pythonç‰ˆæœ¬</h3>
                        <p>${data.python_version.split(' ')[0]}</p>
                    </div>
                `;
            })
            .catch(error => {
                console.error('åŠ è½½ç³»ç»ŸçŠ¶æ€å¤±è´¥:', error);
            });
        }
        
        // åˆ·æ–°ç»“æœæ–‡ä»¶
        function refreshResults() {
            fetch('/api/results')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('fileList');
                container.innerHTML = '';
                
                Object.keys(data).forEach(category => {
                    const files = data[category];
                    if (files.length > 0) {
                        files.forEach(file => {
                            const fileItem = document.createElement('div');
                            fileItem.className = 'file-item';
                            fileItem.onclick = () => viewFile(file.path);
                            
                            const size = formatFileSize(file.size);
                            const date = new Date(file.modified * 1000).toLocaleString();
                            
                            fileItem.innerHTML = `
                                <h4>ğŸ“„ ${file.name}</h4>
                                <p>ğŸ“ ${category} | ğŸ“ ${size} | ğŸ•’ ${date}</p>
                            `;
                            container.appendChild(fileItem);
                        });
                    }
                });
                
                if (container.children.length === 0) {
                    container.innerHTML = '<div class="file-item"><h4>ğŸ“­ æš‚æ— ç»“æœæ–‡ä»¶</h4><p>æ‰§è¡Œä»»åŠ¡åå°†æ˜¾ç¤ºç”Ÿæˆçš„æ–‡ä»¶</p></div>';
                }
            })
            .catch(error => {
                console.error('åŠ è½½ç»“æœæ–‡ä»¶å¤±è´¥:', error);
            });
        }
        
        // æŸ¥çœ‹æ–‡ä»¶
        function viewFile(filePath) {
            if (filePath.endsWith('.html')) {
                // ç›´æ¥åœ¨æ–°çª—å£æ‰“å¼€HTMLæ–‡ä»¶
                window.open(`/api/view_file/${filePath}`, '_blank');
            } else {
                // å…¶ä»–æ–‡ä»¶ç±»å‹æ˜¾ç¤ºå†…å®¹
                fetch(`/api/view_file/${filePath}`)
                .then(response => response.json())
                .then(data => {
                    const content = JSON.stringify(data, null, 2);
                    const newWindow = window.open('', '_blank');
                    newWindow.document.write(`
                        <html>
                        <head><title>${filePath}</title></head>
                        <body style="font-family: monospace; padding: 20px;">
                        <h2>${filePath}</h2>
                        <pre>${content}</pre>
                        </body>
                        </html>
                    `);
                })
                .catch(error => {
                    showNotification(`æ‰“å¼€æ–‡ä»¶å¤±è´¥: ${error}`, 'error');
                });
            }
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addOutput('ğŸŒ Webç•Œé¢åˆå§‹åŒ–å®Œæˆ', 'info');

            // åˆå§‹åŒ–é…ç½®ç›‘å¬
            const configInputs = document.querySelectorAll('input[type="radio"]');
            configInputs.forEach(input => {
                input.addEventListener('change', updateStatusDisplay);
            });

            // åˆå§‹åŒ–çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay();

            // æµ‹è¯•MT5è¿æ¥
            testMT5Connection();

            // åŠ è½½ç³»ç»ŸçŠ¶æ€
            loadSystemStatus();
            setInterval(loadSystemStatus, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
        });

        function testMT5Connection() {
            fetch('/test_mt5')
            .then(response => response.json())
            .then(data => {
                const mt5Status = document.getElementById('mt5-status');
                if (data.success) {
                    mt5Status.textContent = 'âœ… å·²è¿æ¥';
                    mt5Status.style.color = '#28a745';
                } else {
                    mt5Status.textContent = 'âŒ æœªè¿æ¥';
                    mt5Status.style.color = '#dc3545';
                }
            })
            .catch(error => {
                const mt5Status = document.getElementById('mt5-status');
                mt5Status.textContent = 'âš ï¸ æ£€æµ‹å¤±è´¥';
                mt5Status.style.color = '#ffc107';
            });
        }
    </script>
</body>
</html>
