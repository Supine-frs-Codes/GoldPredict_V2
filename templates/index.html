<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•á ÈªÑÈáë‰ª∑Ê†ºÈ¢ÑÊµãÁ≥ªÁªü - Êìç‰ΩúÁïåÈù¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .action-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary { background: linear-gradient(45deg, #007bff, #0056b3); color: white; }
        .btn-success { background: linear-gradient(45deg, #28a745, #1e7e34); color: white; }
        .btn-warning { background: linear-gradient(45deg, #ffc107, #e0a800); color: #333; }
        .btn-danger { background: linear-gradient(45deg, #dc3545, #c82333); color: white; }
        .btn-info { background: linear-gradient(45deg, #17a2b8, #138496); color: white; }
        
        .output-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .output-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            border: 2px solid #333;
        }
        
        .output-line {
            margin-bottom: 5px;
            word-wrap: break-word;
        }
        
        .timestamp {
            color: #888;
            font-size: 12px;
        }
        
        .task-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-running { background: #ffc107; color: #333; }
        .status-completed { background: #28a745; color: white; }
        .status-failed { background: #dc3545; color: white; }
        
        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .file-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: #28a745; }
        .notification.error { background: #dc3545; }
        .notification.info { background: #17a2b8; }

        /* ÈÖçÁΩÆÈù¢ÊùøÊ†∑Âºè */
        .config-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: white;
        }

        .config-panel h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .config-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .config-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 8px;
        }

        .config-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .config-option {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .config-option:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .config-option input[type="radio"] {
            margin-right: 12px;
            margin-top: 2px;
            transform: scale(1.2);
        }

        .config-option input[type="radio"]:checked + .option-label {
            font-weight: bold;
            color: #ffd700;
        }

        .config-option input[type="radio"]:checked {
            accent-color: #ffd700;
        }

        .config-option.selected {
            border-color: #ffd700;
            background: rgba(255,215,0,0.2);
        }

        .option-content {
            flex: 1;
        }

        .option-label {
            display: block;
            font-weight: 500;
            margin-bottom: 4px;
            font-size: 1.1em;
        }

        .option-desc {
            display: block;
            font-size: 0.9em;
            opacity: 0.8;
            line-height: 1.3;
        }

        .config-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .config-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 150px;
        }

        .config-btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,107,0.4);
        }

        .config-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255,107,107,0.6);
        }

        .config-btn.secondary {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
            box-shadow: 0 4px 15px rgba(116,185,255,0.4);
        }

        .config-btn.secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(116,185,255,0.6);
        }

        .config-btn.info {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            color: white;
            box-shadow: 0 4px 15px rgba(162,155,254,0.4);
        }

        .config-btn.info:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(162,155,254,0.6);
        }

        .config-btn.success {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
            box-shadow: 0 4px 15px rgba(0,184,148,0.4);
        }

        .config-btn.success:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,184,148,0.6);
        }

        .config-btn.warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            color: white;
            box-shadow: 0 4px 15px rgba(253,203,110,0.4);
        }

        .config-btn.warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(253,203,110,0.6);
        }
        
        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü•á ÈªÑÈáë‰ª∑Ê†ºÈ¢ÑÊµãÁ≥ªÁªü</h1>
            <p>ÂÆûÊó∂Êìç‰ΩúÁïåÈù¢ - ‰∏ÄÈîÆÊâßË°åÂêÑÁßçÂäüËÉΩÊ®°Âùó</p>
        </div>

        <!-- ÈÖçÁΩÆÈù¢Êùø -->
        <div class="config-panel">
            <h2>‚öôÔ∏è È¢ÑÊµãÈÖçÁΩÆ</h2>
            <div class="config-grid">
                <div class="config-section">
                    <h3>üìä Êï∞ÊçÆÊ∫êÈÄâÊã©</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="data_source" value="mt5" checked>
                            <span class="option-label">üîó MetaTrader 5 (ÂÆûÊó∂)</span>
                            <span class="option-desc">ÊúÄÊñ∞ÂÆûÊó∂Êï∞ÊçÆÔºåÊó†APIÈôêÂà∂</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="data_source" value="multi_source">
                            <span class="option-label">üåê Â§öÊï∞ÊçÆÊ∫ê (Êô∫ËÉΩ)</span>
                            <span class="option-desc">MT5 + APIÊô∫ËÉΩÂàáÊç¢</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="data_source" value="yahoo">
                            <span class="option-label">üìà Yahoo Finance</span>
                            <span class="option-desc">‰º†ÁªüÊï∞ÊçÆÊ∫ê</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="data_source" value="alpha_vantage">
                            <span class="option-label">üîë Alpha Vantage</span>
                            <span class="option-desc">ÈúÄË¶ÅAPIÂØÜÈí•</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>üìÖ Êó∂Èó¥Ë∑®Â∫¶</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1d">
                            <span class="option-label">‚ö° 1Â§© (ÂÆûÊó∂)</span>
                            <span class="option-desc">ÊúÄÊñ∞‰ª∑Ê†ºÔºåÂÆûÊó∂Êõ¥Êñ∞</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1w">
                            <span class="option-label">üìä 1Âë®</span>
                            <span class="option-desc">Áü≠ÊúüË∂ãÂäøÂàÜÊûê</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1mo">
                            <span class="option-label">üìà 1‰∏™Êúà</span>
                            <span class="option-desc">‰∏≠ÊúüË∂ãÂäøÂàÜÊûê</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="3mo" checked>
                            <span class="option-label">üìä 3‰∏™Êúà</span>
                            <span class="option-desc">Ê†áÂáÜÂàÜÊûêÂë®Êúü</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="6mo">
                            <span class="option-label">üìà 6‰∏™Êúà</span>
                            <span class="option-desc">ÈïøÊúüË∂ãÂäøÂàÜÊûê</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="time_period" value="1y">
                            <span class="option-label">üìä 1Âπ¥</span>
                            <span class="option-desc">Âπ¥Â∫¶Ë∂ãÂäøÂàÜÊûê</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>üñ•Ô∏è Â§ÑÁêÜÂô®ÈÖçÁΩÆ</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="auto" checked>
                            <span class="option-label">üöÄ Ëá™Âä® (Êé®Ëçê)</span>
                            <span class="option-desc">Á≥ªÁªüËá™Âä®ÈÄâÊã©ÊúÄ‰ºòÊ†∏ÂøÉÊï∞</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="single">
                            <span class="option-label">üîÑ ÂçïÊ†∏</span>
                            <span class="option-desc">ÂçïÁ∫øÁ®ãÂ§ÑÁêÜ</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="half">
                            <span class="option-label">‚ö° ÂçäÊï∞Ê†∏ÂøÉ</span>
                            <span class="option-desc">Âπ≥Ë°°ÊÄßËÉΩÂíåÁ®≥ÂÆöÊÄß</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="cpu_cores" value="max">
                            <span class="option-label">üî• ÂÖ®ÈÉ®Ê†∏ÂøÉ</span>
                            <span class="option-desc">ÊúÄÂ§ßÊÄßËÉΩÊ®°Âºè</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>üéØ È¢ÑÊµãÊ®°Âºè</h3>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="prediction_mode" value="simple" checked>
                            <span class="option-label">üîÆ ÁÆÄÂçïÈ¢ÑÊµã</span>
                            <span class="option-desc">Âü∫Á°ÄÊäÄÊúØÂàÜÊûêÔºåÂø´ÈÄüÊâßË°å</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="prediction_mode" value="advanced">
                            <span class="option-label">üß† Â§çÊùÇÈ¢ÑÊµã</span>
                            <span class="option-desc">Â§öÊåáÊ†áÈõÜÊàêÔºåÁ≤æÁ°ÆÂàÜÊûê</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="prediction_mode" value="ultimate">
                            <span class="option-label">üöÄ ÁªàÊûÅÈ¢ÑÊµã</span>
                            <span class="option-desc">AIÂ¢ûÂº∫ÔºåÊúÄÈ´òÁ≤æÂ∫¶</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="config-actions">
                <button class="config-btn primary" onclick="runConfiguredPrediction()">
                    üéØ ÊâßË°åÈÖçÁΩÆÈ¢ÑÊµã
                </button>
                <button class="config-btn secondary" onclick="resetConfig()">
                    üîÑ ÈáçÁΩÆÈÖçÁΩÆ
                </button>
                <button class="config-btn info" onclick="testDataSource()">
                    üß™ ÊµãËØïÊï∞ÊçÆÊ∫ê
                </button>
                <button class="config-btn success" onclick="getRealTimeData()">
                    üì° ÂÆûÊó∂Êï∞ÊçÆÊµÅ
                </button>
                <button class="config-btn warning" onclick="openRealTimePrediction()">
                    ü§ñ ÂÆûÊó∂È¢ÑÊµãÁ≥ªÁªü
                </button>
            </div>
        </div>

        <!-- Á≥ªÁªüÁä∂ÊÄÅÈù¢Êùø -->
        <div class="status-panel">
            <h2>üìä Á≥ªÁªüÁä∂ÊÄÅ</h2>
            <div class="status-grid" id="systemStatus">
                <div class="status-item">
                    <h3>üîÑ ÊúçÂä°Âô®Áä∂ÊÄÅ</h3>
                    <p id="server-status">ËøêË°å‰∏≠</p>
                </div>
                <div class="status-item">
                    <h3>üìä ÂΩìÂâçÊï∞ÊçÆÊ∫ê</h3>
                    <p id="current-data-source">MetaTrader 5</p>
                </div>
                <div class="status-item">
                    <h3>üñ•Ô∏è CPUÊ†∏ÂøÉ</h3>
                    <p id="cpu-cores">Ëá™Âä®</p>
                </div>
                <div class="status-item">
                    <h3>‚è∞ ÊúÄÂêéÊõ¥Êñ∞</h3>
                    <p id="last-update">--</p>
                </div>
                <div class="status-item">
                    <h3>üì° MT5ËøûÊé•</h3>
                    <p id="mt5-status">Ê£ÄÊµã‰∏≠...</p>
                </div>
                <div class="status-item">
                    <h3>üíæ Êï∞ÊçÆËÆ∞ÂΩï</h3>
                    <p id="data-records">--</p>
                </div>
            </div>
        </div>
        
        <!-- ÊéßÂà∂Èù¢Êùø -->
        <div class="control-panel">
            <!-- Âü∫Á°ÄÂäüËÉΩ -->
            <div class="panel">
                <h2>üîß Âü∫Á°ÄÂäüËÉΩ</h2>
                <div class="button-grid">
                    <button class="action-btn btn-info" onclick="runTask('gpu_test')">
                        üñ•Ô∏è GPUÊµãËØï
                    </button>
                    <button class="action-btn btn-info" onclick="runTask('gpu_setup')">
                        ‚öôÔ∏è GPUÁéØÂ¢ÉÊ£ÄÊµã
                    </button>
                    <button class="action-btn btn-primary" onclick="runTask('data_collection')">
                        üìä Êï∞ÊçÆÊî∂ÈõÜ
                    </button>
                    <button class="action-btn btn-success" onclick="runTask('quick_demo')">
                        ‚ö° Âø´ÈÄüÊºîÁ§∫
                    </button>
                    <button class="action-btn btn-warning" onclick="runTask('organize_files')">
                        üóÇÔ∏è Êï¥ÁêÜÊñá‰ª∂
                    </button>
                </div>
            </div>
            
            <!-- È´òÁ∫ßÂäüËÉΩ -->
            <div class="panel">
                <h2>üöÄ È´òÁ∫ßÂäüËÉΩ</h2>
                <div class="button-grid">
                    <button class="action-btn btn-primary" onclick="runTask('train_basic')">
                        ü§ñ Âü∫Á°ÄËÆ≠ÁªÉ
                    </button>
                    <button class="action-btn btn-success" onclick="runTask('train_optimized')">
                        ‚ö° ‰ºòÂåñËÆ≠ÁªÉ
                    </button>
                    <button class="action-btn btn-success" onclick="runTask('predict_simple')">
                        üîÆ ÁÆÄÂçïÈ¢ÑÊµã
                    </button>
                    <button class="action-btn btn-info" onclick="runTask('predict_multiple')">
                        üìä Â§öÊó∂Èó¥È¢ÑÊµã
                    </button>
                    <button class="action-btn btn-warning" onclick="runTask('predict_uncertainty')">
                        üìà ‰∏çÁ°ÆÂÆöÊÄßÈ¢ÑÊµã
                    </button>
                </div>

                <div class="section">
                    <h3>[ÁªàÊûÅ] ‰∏ÄÈîÆÈ¢ÑÊµãÁ≥ªÁªü</h3>
                    <button class="action-btn btn-danger" onclick="runTask('ultimate_prediction')"
                            style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); font-size: 16px; font-weight: bold;">
                        üöÄ ‰∏ÄÈîÆÁªàÊûÅÈ¢ÑÊµã
                    </button>
                    <button class="action-btn btn-dark" onclick="runTask('advanced_training')"
                            style="background: linear-gradient(45deg, #2c2c54, #40407a); font-size: 16px; font-weight: bold;">
                        üß† È´òÁ∫ßÊ∑±Â∫¶ËÆ≠ÁªÉ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ËæìÂá∫Èù¢Êùø -->
        <div class="output-panel">
            <h2>üìù ÂÆûÊó∂ËæìÂá∫</h2>
            <div class="output-container" id="outputContainer">
                <div class="output-line">üåê WebÁïåÈù¢Â∑≤ÂêØÂä®ÔºåÁ≠âÂæÖ‰ªªÂä°ÊâßË°å...</div>
            </div>
        </div>
        
        <!-- ÁªìÊûúÊñá‰ª∂Èù¢Êùø -->
        <div class="results-panel">
            <h2>üìÅ ÁªìÊûúÊñá‰ª∂</h2>
            <button class="action-btn btn-info" onclick="refreshResults()">üîÑ Âà∑Êñ∞Êñá‰ª∂ÂàóË°®</button>
            <div class="file-list" id="fileList">
                <div class="file-item">
                    <h4>üîÑ Âä†ËΩΩ‰∏≠...</h4>
                    <p>Ê≠£Âú®Êâ´ÊèèÁªìÊûúÊñá‰ª∂</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÈÄöÁü• -->
    <div id="notification" class="notification"></div>
    
    <script>
        // Socket.IOËøûÊé•
        const socket = io();
        let currentTasks = {};
        
        // ËøûÊé•‰∫ã‰ª∂
        socket.on('connect', function() {
            console.log('Â∑≤ËøûÊé•Âà∞ÊúçÂä°Âô®');
            showNotification('Â∑≤ËøûÊé•Âà∞ÊúçÂä°Âô®', 'success');
            loadSystemStatus();
            refreshResults();
        });
        
        // ‰ªªÂä°ÂºÄÂßã
        socket.on('task_start', function(data) {
            addOutput(`üöÄ ÂºÄÂßãÊâßË°å: ${data.description}`, 'info');
            currentTasks[data.task_id] = data;
        });
        
        // ‰ªªÂä°ËæìÂá∫
        socket.on('task_output', function(data) {
            addOutput(data.output, 'output');
        });
        
        // ‰ªªÂä°ÂÆåÊàê
        socket.on('task_complete', function(data) {
            if (data.status === 'success') {
                addOutput(`‚úÖ ‰ªªÂä°ÂÆåÊàê: ${currentTasks[data.task_id]?.description}`, 'success');
                showNotification('‰ªªÂä°ÊâßË°åÊàêÂäüÔºÅ', 'success');
                refreshResults(); // Âà∑Êñ∞ÁªìÊûúÊñá‰ª∂
            } else {
                addOutput(`‚ùå ‰ªªÂä°Â§±Ë¥•: ${currentTasks[data.task_id]?.description}`, 'error');
                showNotification('‰ªªÂä°ÊâßË°åÂ§±Ë¥•ÔºÅ', 'error');
            }
            delete currentTasks[data.task_id];
        });
        
        // ‰ªªÂä°ÈîôËØØ
        socket.on('task_error', function(data) {
            addOutput(`üí• ÈîôËØØ: ${data.error}`, 'error');
            showNotification(`ÊâßË°åÈîôËØØ: ${data.error}`, 'error');
            delete currentTasks[data.task_id];
        });
        
        // ÊâßË°å‰ªªÂä°
        function runTask(taskType) {
            const button = event.target;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> ÊâßË°å‰∏≠...';
            
            fetch('/api/run_task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({task_type: taskType})
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showNotification(`ÂêØÂä®Â§±Ë¥•: ${data.error}`, 'error');
                } else {
                    addOutput(`üìã ‰ªªÂä°Â∑≤ÂêØÂä®: ${data.description}`, 'info');
                }
            })
            .catch(error => {
                showNotification(`ËØ∑Ê±ÇÂ§±Ë¥•: ${error}`, 'error');
            })
            .finally(() => {
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = button.innerHTML.replace('<span class="loading"></span> ÊâßË°å‰∏≠...', button.textContent);
                }, 2000);
            });
        }
        
        // Ê∑ªÂä†ËæìÂá∫
        function addOutput(text, type = 'output') {
            const container = document.getElementById('outputContainer');
            const line = document.createElement('div');
            line.className = 'output-line';
            
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': '#00bfff',
                'success': '#00ff00', 
                'error': '#ff4444',
                'output': '#00ff00'
            };
            
            line.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span style="color: ${colors[type]}">${text}</span>`;
            container.appendChild(line);
            container.scrollTop = container.scrollHeight;
        }
        
        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ÈÖçÁΩÆÁõ∏ÂÖ≥ÂáΩÊï∞
        function getSelectedConfig() {
            const dataSource = document.querySelector('input[name="data_source"]:checked')?.value || 'mt5';
            const timePeriod = document.querySelector('input[name="time_period"]:checked')?.value || '3mo';
            const cpuCores = document.querySelector('input[name="cpu_cores"]:checked')?.value || 'auto';
            const predictionMode = document.querySelector('input[name="prediction_mode"]:checked')?.value || 'simple';

            return {
                data_source: dataSource,
                time_period: timePeriod,
                cpu_cores: cpuCores,
                prediction_mode: predictionMode
            };
        }

        function updateStatusDisplay() {
            const config = getSelectedConfig();

            // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
            const dataSourceNames = {
                'mt5': 'MetaTrader 5',
                'multi_source': 'Â§öÊï∞ÊçÆÊ∫ê',
                'yahoo': 'Yahoo Finance',
                'alpha_vantage': 'Alpha Vantage'
            };

            const cpuCoreNames = {
                'auto': 'Ëá™Âä®',
                'single': 'ÂçïÊ†∏',
                'half': 'ÂçäÊï∞Ê†∏ÂøÉ',
                'max': 'ÂÖ®ÈÉ®Ê†∏ÂøÉ'
            };

            document.getElementById('current-data-source').textContent = dataSourceNames[config.data_source];
            document.getElementById('cpu-cores').textContent = cpuCoreNames[config.cpu_cores];
        }

        function runConfiguredPrediction() {
            const config = getSelectedConfig();

            showNotification(`ÂêØÂä®${config.prediction_mode}È¢ÑÊµã - Êï∞ÊçÆÊ∫ê: ${config.data_source}, Êó∂Èó¥: ${config.time_period}`, 'info');

            // Ê†πÊçÆÈÖçÁΩÆÈÄâÊã©Áõ∏Â∫îÁöÑÈ¢ÑÊµãÊ®°Âºè
            let taskName;
            if (config.prediction_mode === 'simple') {
                taskName = 'predict_simple';
            } else if (config.prediction_mode === 'advanced') {
                taskName = 'predict_multiple';
            } else if (config.prediction_mode === 'ultimate') {
                taskName = 'ultimate_prediction';
            }

            // ÊâßË°å‰ªªÂä°Ôºå‰º†ÈÄíÈÖçÁΩÆÂèÇÊï∞
            runTaskWithConfig(taskName, config);
        }

        function runTaskWithConfig(taskName, config) {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '';
            outputDiv.style.display = 'block';

            // ÊòæÁ§∫ÈÖçÁΩÆ‰ø°ÊÅØ
            outputDiv.innerHTML += `<div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                <strong>üéØ È¢ÑÊµãÈÖçÁΩÆ:</strong><br>
                üìä Êï∞ÊçÆÊ∫ê: ${config.data_source}<br>
                üìÖ Êó∂Èó¥Ë∑®Â∫¶: ${config.time_period}<br>
                üñ•Ô∏è CPUÊ†∏ÂøÉ: ${config.cpu_cores}<br>
                üéØ È¢ÑÊµãÊ®°Âºè: ${config.prediction_mode}
            </div>`;

            showNotification(`üöÄ ÂºÄÂßãÊâßË°å: ${taskName}`, 'info');

            fetch('/run_task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    task: taskName,
                    config: config
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`‚úÖ ‰ªªÂä°ÂÆåÊàê: ${taskName}`, 'success');
                } else {
                    showNotification(`‚ùå ‰ªªÂä°Â§±Ë¥•: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('‚ùå ÁΩëÁªúÈîôËØØ', 'error');
            });

            // ÂºÄÂßãËΩÆËØ¢ËæìÂá∫
            pollOutput();
        }

        function resetConfig() {
            // ÈáçÁΩÆÊâÄÊúâÈÖçÁΩÆ‰∏∫ÈªòËÆ§ÂÄº
            document.querySelector('input[name="data_source"][value="mt5"]').checked = true;
            document.querySelector('input[name="time_period"][value="3mo"]').checked = true;
            document.querySelector('input[name="cpu_cores"][value="auto"]').checked = true;
            document.querySelector('input[name="prediction_mode"][value="simple"]').checked = true;

            updateStatusDisplay();
            showNotification('üîÑ ÈÖçÁΩÆÂ∑≤ÈáçÁΩÆ‰∏∫ÈªòËÆ§ÂÄº', 'info');
        }

        function testDataSource() {
            const config = getSelectedConfig();
            showNotification(`üß™ ÊµãËØïÊï∞ÊçÆÊ∫ê: ${config.data_source}`, 'info');

            // ÊâßË°åÊï∞ÊçÆÊ∫êÊµãËØï
            runTaskWithConfig('test_data_source', config);
        }

        function getRealTimeData() {
            const config = getSelectedConfig();

            if (config.data_source !== 'mt5') {
                showNotification('‚ö†Ô∏è ÂÆûÊó∂Êï∞ÊçÆÊµÅÈúÄË¶ÅMetaTrader 5Êï∞ÊçÆÊ∫ê', 'error');
                return;
            }

            showNotification('üì° ÂêØÂä®ÂÆûÊó∂Êï∞ÊçÆÊµÅ...', 'info');
            runTaskWithConfig('realtime_data', config);
        }

        function openRealTimePrediction() {
            // ÊâìÂºÄÂÆûÊó∂È¢ÑÊµãÁ≥ªÁªüÁ™óÂè£
            const realtimeUrl = 'http://localhost:5001';
            const realtimeWindow = window.open(realtimeUrl, 'realtime_prediction', 'width=1200,height=800,scrollbars=yes,resizable=yes');

            if (realtimeWindow) {
                showNotification('ü§ñ ÂÆûÊó∂È¢ÑÊµãÁ≥ªÁªüÂ∑≤ÊâìÂºÄ', 'success');
            } else {
                showNotification('‚ùå Êó†Ê≥ïÊâìÂºÄÂÆûÊó∂È¢ÑÊµãÁ≥ªÁªüÔºåËØ∑Ê£ÄÊü•ÂºπÁ™óÊã¶Êà™', 'error');
                // Â§áÁî®ÊñπÊ°àÔºöÂú®ÂΩìÂâçÈ°µÈù¢ÊòæÁ§∫ÈìæÊé•
                const outputDiv = document.getElementById('output');
                outputDiv.innerHTML = `
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3>ü§ñ ÂÆûÊó∂È¢ÑÊµãÁ≥ªÁªü</h3>
                        <p>Â¶ÇÊûúÊñ∞Á™óÂè£Ê≤°ÊúâÊâìÂºÄÔºåËØ∑ÁÇπÂáª‰∏ãÈù¢ÁöÑÈìæÊé•Ôºö</p>
                        <a href="${realtimeUrl}" target="_blank" style="color: #1976d2; font-weight: bold; font-size: 1.2em;">
                            ${realtimeUrl}
                        </a>
                        <br><br>
                        <p><strong>ÂäüËÉΩÁâπÊÄßÔºö</strong></p>
                        <ul>
                            <li>üîÑ ÊØè5ÂàÜÈíüËá™Âä®È¢ÑÊµã</li>
                            <li>üìä ËΩªÈáèÁ∫ß + Â§çÊùÇ + Ê∑±Â∫¶Â≠¶‰π†È¢ÑÊµã</li>
                            <li>üìà ÂÆûÊó∂‰∫§Êòì‰ø°Âè∑</li>
                            <li>‚úÖ ÂáÜÁ°ÆÁéáÈ™åËØÅ</li>
                            <li>üì± ÂÆûÊó∂WebÁïåÈù¢</li>
                        </ul>
                    </div>
                `;
                outputDiv.style.display = 'block';
            }
        }
        
        // Âä†ËΩΩÁ≥ªÁªüÁä∂ÊÄÅ
        function loadSystemStatus() {
            fetch('/api/system_status')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('systemStatus');
                container.innerHTML = `
                    <div class="status-item">
                        <h3>üñ•Ô∏è GPUÁä∂ÊÄÅ</h3>
                        <p>${data.gpu_available ? '‚úÖ ' + data.gpu_info : '‚ùå Êú™Ê£ÄÊµãÂà∞GPU'}</p>
                    </div>
                    <div class="status-item">
                        <h3>üìä Êï∞ÊçÆÊñá‰ª∂</h3>
                        <p>${data.data_files} ‰∏™Êï∞ÊçÆÊñá‰ª∂</p>
                    </div>
                    <div class="status-item">
                        <h3>ü§ñ Ê®°ÂûãÊñá‰ª∂</h3>
                        <p>${data.model_files} ‰∏™Ê®°ÂûãÊñá‰ª∂</p>
                    </div>
                    <div class="status-item">
                        <h3>üêç PythonÁâàÊú¨</h3>
                        <p>${data.python_version.split(' ')[0]}</p>
                    </div>
                `;
            })
            .catch(error => {
                console.error('Âä†ËΩΩÁ≥ªÁªüÁä∂ÊÄÅÂ§±Ë¥•:', error);
            });
        }
        
        // Âà∑Êñ∞ÁªìÊûúÊñá‰ª∂
        function refreshResults() {
            fetch('/api/results')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('fileList');
                container.innerHTML = '';
                
                Object.keys(data).forEach(category => {
                    const files = data[category];
                    if (files.length > 0) {
                        files.forEach(file => {
                            const fileItem = document.createElement('div');
                            fileItem.className = 'file-item';
                            fileItem.onclick = () => viewFile(file.path);
                            
                            const size = formatFileSize(file.size);
                            const date = new Date(file.modified * 1000).toLocaleString();
                            
                            fileItem.innerHTML = `
                                <h4>üìÑ ${file.name}</h4>
                                <p>üìÅ ${category} | üìè ${size} | üïí ${date}</p>
                            `;
                            container.appendChild(fileItem);
                        });
                    }
                });
                
                if (container.children.length === 0) {
                    container.innerHTML = '<div class="file-item"><h4>üì≠ ÊöÇÊó†ÁªìÊûúÊñá‰ª∂</h4><p>ÊâßË°å‰ªªÂä°ÂêéÂ∞ÜÊòæÁ§∫ÁîüÊàêÁöÑÊñá‰ª∂</p></div>';
                }
            })
            .catch(error => {
                console.error('Âä†ËΩΩÁªìÊûúÊñá‰ª∂Â§±Ë¥•:', error);
            });
        }
        
        // Êü•ÁúãÊñá‰ª∂
        function viewFile(filePath) {
            if (filePath.endsWith('.html')) {
                // Áõ¥Êé•Âú®Êñ∞Á™óÂè£ÊâìÂºÄHTMLÊñá‰ª∂
                window.open(`/api/view_file/${filePath}`, '_blank');
            } else {
                // ÂÖ∂‰ªñÊñá‰ª∂Á±ªÂûãÊòæÁ§∫ÂÜÖÂÆπ
                fetch(`/api/view_file/${filePath}`)
                .then(response => response.json())
                .then(data => {
                    const content = JSON.stringify(data, null, 2);
                    const newWindow = window.open('', '_blank');
                    newWindow.document.write(`
                        <html>
                        <head><title>${filePath}</title></head>
                        <body style="font-family: monospace; padding: 20px;">
                        <h2>${filePath}</h2>
                        <pre>${content}</pre>
                        </body>
                        </html>
                    `);
                })
                .catch(error => {
                    showNotification(`ÊâìÂºÄÊñá‰ª∂Â§±Ë¥•: ${error}`, 'error');
                });
            }
        }
        
        // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            addOutput('üåê WebÁïåÈù¢ÂàùÂßãÂåñÂÆåÊàê', 'info');

            // ÂàùÂßãÂåñÈÖçÁΩÆÁõëÂê¨
            const configInputs = document.querySelectorAll('input[type="radio"]');
            configInputs.forEach(input => {
                input.addEventListener('change', updateStatusDisplay);
            });

            // ÂàùÂßãÂåñÁä∂ÊÄÅÊòæÁ§∫
            updateStatusDisplay();

            // ÊµãËØïMT5ËøûÊé•
            testMT5Connection();

            // Âä†ËΩΩÁ≥ªÁªüÁä∂ÊÄÅ
            loadSystemStatus();
            setInterval(loadSystemStatus, 30000); // ÊØè30ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
        });

        function testMT5Connection() {
            fetch('/test_mt5')
            .then(response => response.json())
            .then(data => {
                const mt5Status = document.getElementById('mt5-status');
                if (data.success) {
                    mt5Status.textContent = '‚úÖ Â∑≤ËøûÊé•';
                    mt5Status.style.color = '#28a745';
                } else {
                    mt5Status.textContent = '‚ùå Êú™ËøûÊé•';
                    mt5Status.style.color = '#dc3545';
                }
            })
            .catch(error => {
                const mt5Status = document.getElementById('mt5-status');
                mt5Status.textContent = '‚ö†Ô∏è Ê£ÄÊµãÂ§±Ë¥•';
                mt5Status.style.color = '#ffc107';
            });
        }
    </script>
</body>
</html>
